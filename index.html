<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Checklist Vehicular - Ejecutiva Ambiental</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, #2d5f4f 0%, #3d7f6a 100%);
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .header p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d5f4f;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
            margin-bottom: 0.5rem;
        }

        .form-group label.required::after {
            content: " *";
            color: #e74c3c;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #2d5f4f;
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .radio-option {
            flex: 1;
            min-width: 120px;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 0.75rem;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .radio-option input[type="radio"]:checked + label {
            background: #2d5f4f;
            color: white;
            border-color: #2d5f4f;
        }

        .section-header {
            background: #ecf0f1;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin: 1.5rem 0 1rem 0;
            font-weight: 600;
            color: #2d5f4f;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checklist-item {
            padding: 1rem 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .checklist-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .checklist-label {
            flex: 1;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .checklist-options {
            display: flex;
            gap: 0.5rem;
        }

        .check-btn {
            width: 45px;
            height: 45px;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .check-btn:active {
            transform: scale(0.95);
        }

        .check-btn.good {
            background: #27ae60;
            border-color: #27ae60;
            color: white;
        }

        .check-btn.bad {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
        }

        .check-btn.na {
            background: #95a5a6;
            border-color: #95a5a6;
            color: white;
        }

        .observation-field {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            display: none;
        }

        .observation-field.active {
            display: block;
        }

        .observation-field textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ffc107;
            border-radius: 4px;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 60px;
        }

        .observation-field label {
            display: block;
            font-size: 0.85rem;
            color: #856404;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .photo-request {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #fff3cd;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #856404;
            display: none;
        }

        .photo-request.active {
            display: block;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2d5f4f;
            color: white;
        }

        .btn-primary:active {
            background: #1f4838;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
            margin-top: 0.5rem;
        }

        .btn-secondary:active {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
            margin-top: 0.5rem;
        }

        .btn-success:active {
            background: #1e8449;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .photo-section {
            margin-top: 1rem;
        }

        .photo-btn {
            width: 100%;
            padding: 1rem;
            border: 2px dashed #2d5f4f;
            border-radius: 8px;
            background: #ecf9f4;
            color: #2d5f4f;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .photo-item {
            position: relative;
            padding-top: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .photo-item img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.25rem;
            font-size: 0.7rem;
            text-align: center;
        }

        .photo-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .signature-container {
            margin-top: 1rem;
        }

        .signature-pad {
            width: 100%;
            height: 200px;
            border: 2px solid #2d5f4f;
            border-radius: 8px;
            background: white;
            touch-action: none;
            cursor: crosshair;
        }

        .signature-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: #2d5f4f;
            transition: width 0.3s;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .summary-label {
            font-weight: 500;
            color: #555;
        }

        .summary-value {
            font-weight: 600;
            color: #2d5f4f;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2d5f4f;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        input[type="file"] {
            display: none;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 0.5rem;
            z-index: 99;
        }

        .bottom-nav .btn {
            flex: 1;
        }

        .signature-hint {
            text-align: center;
            color: #95a5a6;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.75rem;
        }

        .metric-card {
            background: #ecf9f4;
            border: 1px solid #cfe8de;
            border-radius: 10px;
            padding: 0.9rem;
        }

        .metric-card h3 {
            font-size: 0.8rem;
            color: #4f6b60;
            margin-bottom: 0.35rem;
            font-weight: 600;
        }

        .metric-value {
            font-size: 1.35rem;
            color: #1f4838;
            font-weight: 700;
        }

        .dashboard-list {
            margin-top: 0.75rem;
        }

        .dashboard-row {
            display: flex;
            justify-content: space-between;
            gap: 0.75rem;
            padding: 0.65rem 0;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.88rem;
        }

        .dashboard-row strong {
            color: #2d5f4f;
        }

        .empty-state {
            padding: 1rem;
            border-radius: 8px;
            background: #f8f9fa;
            color: #6c757d;
            text-align: center;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöó Checklist Vehicular</h1>
        <p>Ejecutiva Ambiental</p>
    </div>

    <!-- SCREEN 1: INICIO -->
    <div id="screen-inicio" class="screen active">
        <div class="container">
            <div class="card">
                <div class="card-title">üìã Nueva Inspecci√≥n</div>
                
                <div class="form-group">
                    <label class="required">Veh√≠culo</label>
                    <select id="vehiculo" class="form-control">
                        <option value="">Seleccionar veh√≠culo</option>
                        <option value="VENTO_PLATA">Vento Plata (VW 2020)</option>
                        <option value="VENTO_CARBON">Vento Carb√≥n (VW 2021)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="required">Tipo de Inspecci√≥n</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" name="tipo" id="tipo-salida" value="Salida">
                            <label for="tipo-salida">üöÄ Salida</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="tipo" id="tipo-regreso" value="Regreso">
                            <label for="tipo-regreso">üèÅ Regreso</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required">Conductor</label>
                    <select id="conductor" class="form-control">
                        <option value="">Seleccionar conductor</option>
                        <option value="MARTIN">Mart√≠n</option>
                        <option value="EDUARDO">Eduardo</option>
                        <option value="JIMMY">Jimmy</option>
                        <option value="EDUWIN">Eduwin</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="required">Kilometraje Actual</label>
                    <input type="number" id="kilometraje" class="form-control" placeholder="Ej: 15000">
                </div>

                <div class="form-group">
                    <label>Orden de Trabajo (Opcional)</label>
                    <input type="text" id="orden-trabajo" class="form-control" placeholder="Ej: OT25-001">
                </div>

                <button class="btn btn-primary" onclick="iniciarInspeccion()">
                    Iniciar Inspecci√≥n ‚Üí
                </button>

                <button class="btn btn-secondary" onclick="abrirDashboard()">
                    üìä Ver Dashboard Log√≠stico
                </button>
            </div>
        </div>
    </div>

    <!-- SCREEN DASHBOARD -->
    <div id="screen-dashboard" class="screen">
        <div class="container">
            <div class="card">
                <div class="card-title">üìä Dashboard Log√≠stico Vehicular</div>
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <h3>Inspecciones totales</h3>
                        <div class="metric-value" id="dash-total-inspecciones">0</div>
                    </div>
                    <div class="metric-card">
                        <h3>Veh√≠culos activos</h3>
                        <div class="metric-value" id="dash-vehiculos-activos">0</div>
                    </div>
                    <div class="metric-card">
                        <h3>Incidencias detectadas</h3>
                        <div class="metric-value" id="dash-incidencias">0</div>
                    </div>
                    <div class="metric-card">
                        <h3>Cumplimiento promedio</h3>
                        <div class="metric-value" id="dash-cumplimiento">0%</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üöó Estado por veh√≠culo</div>
                <div id="dashboard-vehiculos" class="dashboard-list"></div>
            </div>

            <div class="card">
                <div class="card-title">üïí √öltimas inspecciones</div>
                <div id="dashboard-recientes" class="dashboard-list"></div>
            </div>

            <button class="btn btn-secondary" onclick="volverInicioDesdeDashboard()">
                ‚Üê Volver
            </button>
        </div>
    </div>

    <!-- SCREEN 2: CHECKLIST -->
    <div id="screen-checklist" class="screen">
        <div class="container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>

            <div class="card">
                <div class="card-title" id="seccion-actual">Secci√≥n 1/6</div>

                <!-- Sistema El√©ctrico -->
                <div id="seccion-electrico" class="seccion-checklist">
                    <div class="section-header">‚ö° SISTEMA EL√âCTRICO</div>
                    
                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Luz delantera alta</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'luz_alta', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_alta', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_alta', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-luz_alta">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No enciende lado derecho"></textarea>
                        </div>
                        <div class="photo-request" id="photo-luz_alta">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Luz delantera baja</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'luz_baja', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_baja', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_baja', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-luz_baja">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Fundida lado izquierdo"></textarea>
                        </div>
                        <div class="photo-request" id="photo-luz_baja">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Luces intermitentes</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'luces_intermitentes', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'luces_intermitentes', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'luces_intermitentes', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-luces_intermitentes">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No funciona derecha trasera"></textarea>
                        </div>
                        <div class="photo-request" id="photo-luces_intermitentes">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Luz direccional</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'luz_direccional', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_direccional', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_direccional', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-luz_direccional">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Parpadea muy r√°pido"></textarea>
                        </div>
                        <div class="photo-request" id="photo-luz_direccional">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Luz freno posterior</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'luz_freno', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_freno', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_freno', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-luz_freno">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Rota izquierda"></textarea>
                        </div>
                        <div class="photo-request" id="photo-luz_freno">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Tablero/Indicadores</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'tablero', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'tablero', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'tablero', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-tablero">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Luz de check engine encendida"></textarea>
                        </div>
                        <div class="photo-request" id="photo-tablero">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Luces de reversa</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'luz_reversa', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_reversa', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'luz_reversa', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-luz_reversa">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No enciende"></textarea>
                        </div>
                        <div class="photo-request" id="photo-luz_reversa">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Alarma de reversa</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'alarma_reversa', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'alarma_reversa', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'alarma_reversa', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-alarma_reversa">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No suena"></textarea>
                        </div>
                        <div class="photo-request" id="photo-alarma_reversa">
                            üì∑ Se requiere foto de este da√±o
                        </div>
                    </div>
                </div>

                <!-- Parte Externa -->
                <div id="seccion-externa" class="seccion-checklist" style="display:none;">
                    <div class="section-header">üöó PARTE EXTERNA</div>
                    
                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Espejo retrovisor izquierdo</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'espejo_izq', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'espejo_izq', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'espejo_izq', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-espejo_izq">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Rajado, suelto, etc."></textarea>
                        </div>
                        <div class="photo-request" id="photo-espejo_izq">
                            üì∑ Se requiere foto del espejo da√±ado
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Espejo retrovisor derecho</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'espejo_der', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'espejo_der', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'espejo_der', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-espejo_der">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Rajado, suelto, etc."></textarea>
                        </div>
                        <div class="photo-request" id="photo-espejo_der">
                            üì∑ Se requiere foto del espejo da√±ado
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Parabrisas delantero</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'parabrisas_del', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'parabrisas_del', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'parabrisas_del', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-parabrisas_del">
                            <label>¬øQu√© da√±o tiene? ¬øD√≥nde est√° ubicado?</label>
                            <textarea placeholder="Ej: Estrella lado conductor superior"></textarea>
                        </div>
                        <div class="photo-request" id="photo-parabrisas_del">
                            üì∑ Se requiere foto del da√±o en parabrisas
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Parabrisas trasero</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'parabrisas_tras', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'parabrisas_tras', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'parabrisas_tras', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-parabrisas_tras">
                            <label>¬øQu√© da√±o tiene? ¬øD√≥nde est√° ubicado?</label>
                            <textarea placeholder="Ej: Rajadura esquina izquierda"></textarea>
                        </div>
                        <div class="photo-request" id="photo-parabrisas_tras">
                            üì∑ Se requiere foto del da√±o en parabrisas trasero
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Llantas (presi√≥n/desgaste)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'llantas', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'llantas', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'llantas', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-llantas">
                            <label>¬øQu√© llanta tiene problema?</label>
                            <textarea placeholder="Ej: Delantera izquierda baja presi√≥n"></textarea>
                        </div>
                        <div class="photo-request" id="photo-llantas">
                            üì∑ Se requiere foto de la llanta con problema
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Carrocer√≠a (golpes/rayones)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'carroceria', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'carroceria', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'carroceria', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-carroceria">
                            <label>¬øQu√© da√±o y d√≥nde est√° ubicado?</label>
                            <textarea placeholder="Ej: Ray√≥n puerta trasera derecha, 20cm"></textarea>
                        </div>
                        <div class="photo-request" id="photo-carroceria">
                            üì∑ Se requiere foto del da√±o en carrocer√≠a
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Limpieza exterior</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'limpieza_ext', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'limpieza_ext', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'limpieza_ext', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-limpieza_ext">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Muy sucio, manchas, etc."></textarea>
                        </div>
                        <div class="photo-request" id="photo-limpieza_ext">
                            üì∑ Se requiere foto del estado exterior
                        </div>
                    </div>
                </div>

                <!-- Parte Interna -->
                <div id="seccion-interna" class="seccion-checklist" style="display:none;">
                    <div class="section-header">ü™ë PARTE INTERNA</div>
                    
                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Cinturones de seguridad</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'cinturones', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'cinturones', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'cinturones', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-cinturones">
                            <label>¬øQu√© cintur√≥n y qu√© falla?</label>
                            <textarea placeholder="Ej: Trasero izquierdo no retrae"></textarea>
                        </div>
                        <div class="photo-request" id="photo-cinturones">
                            üì∑ Se requiere foto del cintur√≥n da√±ado
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Asientos (estado)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'asientos', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'asientos', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'asientos', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-asientos">
                            <label>¬øQu√© asiento y qu√© da√±o?</label>
                            <textarea placeholder="Ej: Conductor roto tapizado"></textarea>
                        </div>
                        <div class="photo-request" id="photo-asientos">
                            üì∑ Se requiere foto del asiento da√±ado
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Claxon</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'claxon', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'claxon', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'claxon', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-claxon">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No suena, suena d√©bil"></textarea>
                        </div>
                        <div class="photo-request" id="photo-claxon">
                            üì∑ Se requiere evidencia del problema
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Limpieza interior</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'limpieza_int', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'limpieza_int', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'limpieza_int', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-limpieza_int">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Polvo acumulado, manchas"></textarea>
                        </div>
                        <div class="photo-request" id="photo-limpieza_int">
                            üì∑ Se requiere foto del estado interior
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Aire acondicionado</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'aire_ac', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'aire_ac', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'aire_ac', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-aire_ac">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No enfr√≠a, hace ruido"></textarea>
                        </div>
                        <div class="photo-request" id="photo-aire_ac">
                            üì∑ Se requiere evidencia del problema
                        </div>
                    </div>
                </div>

                <!-- Documentos -->
                <div id="seccion-documentos" class="seccion-checklist" style="display:none;">
                    <div class="section-header">üìÑ DOCUMENTOS</div>
                    
                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">P√≥liza de seguro</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'seguro', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'seguro', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'seguro', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-seguro">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No est√° en el veh√≠culo, vencida"></textarea>
                        </div>
                        <div class="photo-request" id="photo-seguro">
                            üì∑ Se requiere foto de la p√≥liza
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Tarjeta de circulaci√≥n</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'circulacion', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'circulacion', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'circulacion', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-circulacion">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No est√° en el veh√≠culo"></textarea>
                        </div>
                        <div class="photo-request" id="photo-circulacion">
                            üì∑ Se requiere foto de la tarjeta
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Verificaci√≥n vehicular</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'verificacion', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'verificacion', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'verificacion', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-verificacion">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Vencida, no est√°"></textarea>
                        </div>
                        <div class="photo-request" id="photo-verificacion">
                            üì∑ Se requiere foto de la verificaci√≥n
                        </div>
                    </div>
                </div>

                <!-- Accesorios -->
                <div id="seccion-accesorios" class="seccion-checklist" style="display:none;">
                    <div class="section-header">üõ†Ô∏è ACCESORIOS DE SEGURIDAD</div>
                    
                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Gato hidr√°ulico</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'gato', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'gato', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'gato', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-gato">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No est√°, da√±ado"></textarea>
                        </div>
                        <div class="photo-request" id="photo-gato">
                            üì∑ Se requiere evidencia
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Llanta de refacci√≥n</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'llanta_ref', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'llanta_ref', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'llanta_ref', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-llanta_ref">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Desinflada, no est√°"></textarea>
                        </div>
                        <div class="photo-request" id="photo-llanta_ref">
                            üì∑ Se requiere foto de la llanta
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Se√±ales de emergencia</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'se√±ales', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'se√±ales', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'se√±ales', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-se√±ales">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No est√°n, rotas"></textarea>
                        </div>
                        <div class="photo-request" id="photo-se√±ales">
                            üì∑ Se requiere evidencia
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Botiqu√≠n de primeros auxilios</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'botiquin', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'botiquin', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'botiquin', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-botiquin">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: No est√°, incompleto"></textarea>
                        </div>
                        <div class="photo-request" id="photo-botiquin">
                            üì∑ Se requiere evidencia
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Extintor</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'extintor', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'extintor', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'extintor', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-extintor">
                            <label>¬øQu√© falla espec√≠ficamente?</label>
                            <textarea placeholder="Ej: Vencido, no est√°"></textarea>
                        </div>
                        <div class="photo-request" id="photo-extintor">
                            üì∑ Se requiere foto del extintor/etiqueta
                        </div>
                    </div>
                </div>

                <!-- L√≠quidos -->
                <div id="seccion-liquidos" class="seccion-checklist" style="display:none;">
                    <div class="section-header">üîß L√çQUIDOS Y GASOLINA</div>
                    
                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">L√≠quido de frenos (indicador)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'liq_frenos', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'liq_frenos', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'liq_frenos', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-liq_frenos">
                            <label>¬øQu√© indica?</label>
                            <textarea placeholder="Ej: Nivel bajo"></textarea>
                        </div>
                        <div class="photo-request" id="photo-liq_frenos">
                            üì∑ Se requiere foto del tablero/indicador
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Anticongelante (indicador)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'anticongelante', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'anticongelante', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'anticongelante', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-anticongelante">
                            <label>¬øQu√© indica?</label>
                            <textarea placeholder="Ej: Nivel bajo, temperatura alta"></textarea>
                        </div>
                        <div class="photo-request" id="photo-anticongelante">
                            üì∑ Se requiere foto del tablero/indicador
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Direcci√≥n hidr√°ulica (indicador)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'liq_direccion', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'liq_direccion', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'liq_direccion', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-liq_direccion">
                            <label>¬øQu√© indica?</label>
                            <textarea placeholder="Ej: Nivel bajo"></textarea>
                        </div>
                        <div class="photo-request" id="photo-liq_direccion">
                            üì∑ Se requiere foto del tablero/indicador
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Aceite de motor (indicador)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'aceite_motor', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'aceite_motor', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'aceite_motor', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-aceite_motor">
                            <label>¬øQu√© indica?</label>
                            <textarea placeholder="Ej: Presi√≥n baja, nivel bajo"></textarea>
                        </div>
                        <div class="photo-request" id="photo-aceite_motor">
                            üì∑ Se requiere foto del tablero/indicador
                        </div>
                    </div>

                    <div class="checklist-item">
                        <div class="checklist-header">
                            <div class="checklist-label">Limpia parabrisas (indicador)</div>
                            <div class="checklist-options">
                                <button class="check-btn" onclick="setCheck(this, 'liq_limpia', 'good')">‚úì</button>
                                <button class="check-btn" onclick="setCheck(this, 'liq_limpia', 'bad')">‚úó</button>
                                <button class="check-btn" onclick="setCheck(this, 'liq_limpia', 'na')">‚óã</button>
                            </div>
                        </div>
                        <div class="observation-field" id="obs-liq_limpia">
                            <label>¬øQu√© indica?</label>
                            <textarea placeholder="Ej: Nivel bajo"></textarea>
                        </div>
                        <div class="photo-request" id="photo-liq_limpia">
                            üì∑ Se requiere foto del tablero/indicador
                        </div>
                    </div>

                    <div class="section-header" style="margin-top: 1.5rem;">‚õΩ GASOLINA</div>
                    <div class="form-group">
                        <label>Nivel de gasolina</label>
                        <select id="nivel-gasolina" class="form-control">
                            <option value="">Seleccionar</option>
                            <option value="1/4">1/4</option>
                            <option value="1/2">1/2</option>
                            <option value="3/4">3/4</option>
                            <option value="Lleno">Lleno</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="btn btn-secondary" onclick="anteriorSeccion()" id="btn-anterior" disabled>
                ‚Üê Anterior
            </button>
            <button class="btn btn-primary" onclick="siguienteSeccion()" id="btn-siguiente">
                Siguiente ‚Üí
            </button>
        </div>
    </div>

    <!-- SCREEN 3: FOTOS Y FIRMA -->
    <div id="screen-fotos" class="screen">
        <div class="container">
            <div class="card">
                <div class="card-title">üì∏ Evidencia Fotogr√°fica</div>
                
                <div id="alert-fotos" style="display:none;" class="alert alert-warning">
                    <strong>‚ö†Ô∏è Atenci√≥n:</strong> Se detectaron <span id="count-malos">0</span> items en mal estado. 
                    <br>Las fotos espec√≠ficas ya fueron solicitadas en cada item marcado como malo.
                </div>

                <div class="photo-section">
                    <p style="margin-bottom: 1rem; color: #666; font-size: 0.9rem;">
                        Agrega fotos adicionales si es necesario (panor√°micas, contexto general, etc.)
                    </p>
                    <input type="file" id="photo-input" accept="image/*" capture="environment" multiple onchange="handlePhotos(event)">
                    <button class="photo-btn" onclick="document.getElementById('photo-input').click()">
                        üì∑ Agregar Foto Adicional
                    </button>
                    <div class="photo-preview" id="photo-preview"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üí¨ Observaciones Generales</div>
                <div class="form-group">
                    <textarea id="observaciones" class="form-control" rows="4" placeholder="Comentarios adicionales sobre el estado general del veh√≠culo..."></textarea>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚úçÔ∏è Firma del Conductor</div>
                <p style="margin-bottom: 1rem; color: #666; font-size: 0.9rem;">
                    Firma con tu dedo o stylus en el recuadro
                </p>
                <canvas id="signature-pad" class="signature-pad"></canvas>
                <div class="signature-hint">Arrastra tu dedo para firmar</div>
                <div class="signature-controls">
                    <button class="btn btn-secondary" onclick="limpiarFirma()" style="flex: 1;">üóëÔ∏è Limpiar Firma</button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="btn btn-secondary" onclick="volverChecklist()">
                ‚Üê Volver
            </button>
            <button class="btn btn-primary" onclick="irResumen()">
                Ver Resumen ‚Üí
            </button>
        </div>
    </div>

    <!-- SCREEN 4: RESUMEN -->
    <div id="screen-resumen" class="screen">
        <div class="container">
            <div class="card">
                <div class="card-title">üìä Resumen de Inspecci√≥n</div>
                
                <div class="summary-item">
                    <div class="summary-label">Veh√≠culo</div>
                    <div class="summary-value" id="resumen-vehiculo">-</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Tipo</div>
                    <div class="summary-value" id="resumen-tipo">-</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Conductor</div>
                    <div class="summary-value" id="resumen-conductor">-</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Kilometraje</div>
                    <div class="summary-value" id="resumen-km">-</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Items Buenos ‚úÖ</div>
                    <div class="summary-value" id="resumen-buenos" style="color: #27ae60;">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Items Malos ‚ùå</div>
                    <div class="summary-value" id="resumen-malos" style="color: #e74c3c;">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Items N/A ‚ö™</div>
                    <div class="summary-value" id="resumen-na" style="color: #95a5a6;">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Fotos Adjuntas</div>
                    <div class="summary-value" id="resumen-fotos">0</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Firma</div>
                    <div class="summary-value" id="resumen-firma">‚ùå Sin firma</div>
                </div>
            </div>

            <div id="alert-error" style="display:none;" class="alert alert-danger">
                <strong>‚ö†Ô∏è Error:</strong> <span id="error-mensaje"></span>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="enviarInspeccion()" id="btn-enviar">
                    ‚úÖ Enviar Inspecci√≥n
                </button>
                <button class="btn btn-secondary" onclick="volverFotos()">
                    ‚Üê Volver a Editar
                </button>
            </div>
        </div>
    </div>

    <!-- SCREEN 5: ENVIANDO -->
    <div id="screen-loading" class="loading">
        <div class="spinner"></div>
        <p>Enviando inspecci√≥n...</p>
        <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">Guardando en Google Sheets...</p>
    </div>

    <!-- SCREEN 6: √âXITO -->
    <div id="screen-exito" class="screen">
        <div class="container">
            <div class="card">
                <div class="alert alert-success">
                    <h2 style="margin-bottom: 1rem;">‚úÖ ¬°Inspecci√≥n Guardada!</h2>
                    <p>Los datos se guardaron correctamente en Google Sheets.</p>
                    <p style="margin-top: 1rem;"><strong>ID:</strong> <span id="id-inspeccion">-</span></p>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-success" onclick="abrirPDF()" id="btn-abrir-pdf">
                        üìÑ Abrir PDF
                    </button>
                    <button class="btn btn-secondary" onclick="abrirDashboard()">
                        üìä Ir al Dashboard
                    </button>
                    <button class="btn btn-primary" onclick="nuevaInspeccion()">
                        üîÑ Nueva Inspecci√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Estado global
        const appState = {
            seccionActual: 0,
            secciones: ['electrico', 'externa', 'interna', 'documentos', 'accesorios', 'liquidos'],
            checklist: {},
            observaciones: {},
            fotos: [],
            firmaData: null,
            pdfBlob: null
        };

        const STORAGE_KEY = 'historial_inspecciones_vehiculares';

        // Signature Pad
        let signaturePad;

        // Inicializar cuando cargue la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('signature-pad');
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;
            
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(0, 0, 0)',
                minWidth: 1,
                maxWidth: 3
            });
        });

        function limpiarFirma() {
            signaturePad.clear();
            appState.firmaData = null;
        }

        function obtenerHistorialInspecciones() {
            try {
                return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            } catch (error) {
                console.error('No se pudo leer el historial local:', error);
                return [];
            }
        }

        function guardarInspeccionLocal() {
            const historial = obtenerHistorialInspecciones();
            const totalItems = Object.keys(appState.checklist).length;
            const buenos = Object.values(appState.checklist).filter(v => v === 'good').length;
            const malos = Object.values(appState.checklist).filter(v => v === 'bad').length;
            const na = Object.values(appState.checklist).filter(v => v === 'na').length;
            const cumplimiento = totalItems > 0 ? Math.round((buenos / totalItems) * 100) : 0;

            historial.push({
                id: 'INS-' + Date.now(),
                fecha: new Date().toISOString(),
                vehiculo: appState.vehiculo,
                tipo: appState.tipo,
                conductor: appState.conductor,
                kilometraje: Number(appState.kilometraje),
                nivelGasolina: document.getElementById('nivel-gasolina').value || 'Sin dato',
                buenos,
                malos,
                na,
                totalItems,
                cumplimiento
            });

            localStorage.setItem(STORAGE_KEY, JSON.stringify(historial));
            return historial[historial.length - 1].id;
        }

        function abrirDashboard() {
            renderDashboard();
            const pantallaActiva = document.querySelector('.screen.active');
            if (pantallaActiva && pantallaActiva.id !== 'screen-dashboard') {
                cambiarPantalla(pantallaActiva.id, 'screen-dashboard');
            }
        }

        function volverInicioDesdeDashboard() {
            cambiarPantalla('screen-dashboard', 'screen-inicio');
        }

        function renderDashboard() {
            const historial = obtenerHistorialInspecciones();
            const totalInspecciones = historial.length;
            const vehiculosActivos = new Set(historial.map(h => h.vehiculo)).size;
            const incidencias = historial.reduce((sum, h) => sum + h.malos, 0);
            const cumplimientoPromedio = totalInspecciones > 0
                ? Math.round(historial.reduce((sum, h) => sum + h.cumplimiento, 0) / totalInspecciones)
                : 0;

            document.getElementById('dash-total-inspecciones').textContent = totalInspecciones;
            document.getElementById('dash-vehiculos-activos').textContent = vehiculosActivos;
            document.getElementById('dash-incidencias').textContent = incidencias;
            document.getElementById('dash-cumplimiento').textContent = cumplimientoPromedio + '%';

            renderEstadoVehiculos(historial);
            renderInspeccionesRecientes(historial);
        }

        function renderEstadoVehiculos(historial) {
            const contenedor = document.getElementById('dashboard-vehiculos');
            if (!historial.length) {
                contenedor.innerHTML = '<div class="empty-state">A√∫n no hay inspecciones registradas.</div>';
                return;
            }

            const vehiculos = {};
            historial.forEach(inspeccion => {
                if (!vehiculos[inspeccion.vehiculo] || inspeccion.fecha > vehiculos[inspeccion.vehiculo].fecha) {
                    vehiculos[inspeccion.vehiculo] = inspeccion;
                }
            });

            contenedor.innerHTML = Object.entries(vehiculos)
                .map(([vehiculo, data]) => `
                    <div class="dashboard-row">
                        <div>
                            <strong>${vehiculo.replace('_', ' ')}</strong><br>
                            KM: ${data.kilometraje.toLocaleString('es-MX')} ¬∑ Gasolina: ${data.nivelGasolina}
                        </div>
                        <div>
                            Cumpl.: ${data.cumplimiento}%<br>
                            Incidencias: ${data.malos}
                        </div>
                    </div>
                `).join('');
        }

        function renderInspeccionesRecientes(historial) {
            const contenedor = document.getElementById('dashboard-recientes');
            if (!historial.length) {
                contenedor.innerHTML = '<div class="empty-state">Sin historial para mostrar.</div>';
                return;
            }

            const recientes = [...historial]
                .sort((a, b) => new Date(b.fecha) - new Date(a.fecha))
                .slice(0, 5);

            contenedor.innerHTML = recientes.map(item => `
                <div class="dashboard-row">
                    <div>
                        <strong>${item.vehiculo.replace('_', ' ')}</strong> ¬∑ ${item.tipo}<br>
                        ${item.conductor} ¬∑ ${new Date(item.fecha).toLocaleString('es-MX')}
                    </div>
                    <div>
                        ‚úÖ ${item.buenos} ¬∑ ‚ùå ${item.malos}<br>
                        KM ${item.kilometraje.toLocaleString('es-MX')}
                    </div>
                </div>
            `).join('');
        }

        function setCheck(btn, item, status) {
            const container = btn.parentElement;
            container.querySelectorAll('.check-btn').forEach(b => {
                b.classList.remove('good', 'bad', 'na');
            });
            btn.classList.add(status);
            appState.checklist[item] = status;

            const obsField = document.getElementById('obs-' + item);
            const photoReq = document.getElementById('photo-' + item);
            
            if (status === 'bad') {
                obsField.classList.add('active');
                photoReq.classList.add('active');
            } else {
                obsField.classList.remove('active');
                photoReq.classList.remove('active');
                const textarea = obsField.querySelector('textarea');
                if (textarea) textarea.value = '';
            }

            actualizarProgreso();
        }

        function actualizarProgreso() {
            const progress = ((appState.seccionActual + 1) / appState.secciones.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function iniciarInspeccion() {
            const vehiculo = document.getElementById('vehiculo').value;
            const tipo = document.querySelector('input[name="tipo"]:checked')?.value;
            const conductor = document.getElementById('conductor').value;
            const km = document.getElementById('kilometraje').value;

            if (!vehiculo || !tipo || !conductor || !km) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }

            appState.vehiculo = vehiculo;
            appState.tipo = tipo;
            appState.conductor = conductor;
            appState.kilometraje = km;
            appState.ordenTrabajo = document.getElementById('orden-trabajo').value;

            cambiarPantalla('screen-inicio', 'screen-checklist');
        }

        function siguienteSeccion() {
            if (appState.seccionActual < appState.secciones.length - 1) {
                guardarObservacionesSeccion();
                
                document.getElementById('seccion-' + appState.secciones[appState.seccionActual]).style.display = 'none';
                appState.seccionActual++;
                document.getElementById('seccion-' + appState.secciones[appState.seccionActual]).style.display = 'block';
                document.getElementById('seccion-actual').textContent = `Secci√≥n ${appState.seccionActual + 1}/${appState.secciones.length}`;
                document.getElementById('btn-anterior').disabled = false;
                actualizarProgreso();
            } else {
                guardarObservacionesSeccion();
                cambiarPantalla('screen-checklist', 'screen-fotos');
                verificarItemsMalos();
            }

            if (appState.seccionActual === appState.secciones.length - 1) {
                document.getElementById('btn-siguiente').textContent = 'Continuar ‚Üí';
            }
        }

        function anteriorSeccion() {
            if (appState.seccionActual > 0) {
                guardarObservacionesSeccion();
                
                document.getElementById('seccion-' + appState.secciones[appState.seccionActual]).style.display = 'none';
                appState.seccionActual--;
                document.getElementById('seccion-' + appState.secciones[appState.seccionActual]).style.display = 'block';
                document.getElementById('seccion-actual').textContent = `Secci√≥n ${appState.seccionActual + 1}/${appState.secciones.length}`;
                document.getElementById('btn-siguiente').textContent = 'Siguiente ‚Üí';
                actualizarProgreso();
            }

            if (appState.seccionActual === 0) {
                document.getElementById('btn-anterior').disabled = true;
            }
        }

        function guardarObservacionesSeccion() {
            const seccion = appState.secciones[appState.seccionActual];
            const seccionDiv = document.getElementById('seccion-' + seccion);
            const textareas = seccionDiv.querySelectorAll('.observation-field.active textarea');
            
            textareas.forEach(textarea => {
                const item = textarea.closest('.observation-field').id.replace('obs-', '');
                if (textarea.value.trim()) {
                    appState.observaciones[item] = textarea.value.trim();
                }
            });
        }

        function verificarItemsMalos() {
            const malos = Object.values(appState.checklist).filter(v => v === 'bad').length;
            if (malos > 0) {
                document.getElementById('alert-fotos').style.display = 'block';
                document.getElementById('count-malos').textContent = malos;
            }
        }

        function handlePhotos(event) {
            const files = Array.from(event.target.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    appState.fotos.push({
                        data: e.target.result,
                        caption: 'Foto adicional'
                    });
                    mostrarFotos();
                };
                reader.readAsDataURL(file);
            });
        }

        function mostrarFotos() {
            const preview = document.getElementById('photo-preview');
            preview.innerHTML = '';
            appState.fotos.forEach((foto, index) => {
                const div = document.createElement('div');
                div.className = 'photo-item';
                div.innerHTML = `
                    <img src="${foto.data}" alt="Foto ${index + 1}">
                    <div class="photo-caption">${foto.caption}</div>
                    <button class="photo-remove" onclick="eliminarFoto(${index})">√ó</button>
                `;
                preview.appendChild(div);
            });
        }

        function eliminarFoto(index) {
            appState.fotos.splice(index, 1);
            mostrarFotos();
        }

        function volverChecklist() {
            cambiarPantalla('screen-fotos', 'screen-checklist');
        }

        function irResumen() {
            if (!signaturePad.isEmpty()) {
                appState.firmaData = signaturePad.toDataURL();
            }

            const buenos = Object.values(appState.checklist).filter(v => v === 'good').length;
            const malos = Object.values(appState.checklist).filter(v => v === 'bad').length;
            const na = Object.values(appState.checklist).filter(v => v === 'na').length;

            document.getElementById('resumen-vehiculo').textContent = document.querySelector('#vehiculo option:checked').textContent;
            document.getElementById('resumen-tipo').textContent = appState.tipo;
            document.getElementById('resumen-conductor').textContent = document.querySelector('#conductor option:checked').textContent;
            document.getElementById('resumen-km').textContent = appState.kilometraje + ' km';
            document.getElementById('resumen-buenos').textContent = buenos;
            document.getElementById('resumen-malos').textContent = malos;
            document.getElementById('resumen-na').textContent = na;
            document.getElementById('resumen-fotos').textContent = appState.fotos.length;
            
            const tieneFirma = !signaturePad.isEmpty();
            document.getElementById('resumen-firma').textContent = tieneFirma ? '‚úÖ Firmado' : '‚ùå Sin firma';
            document.getElementById('resumen-firma').style.color = tieneFirma ? '#27ae60' : '#e74c3c';

            cambiarPantalla('screen-fotos', 'screen-resumen');
        }

        function volverFotos() {
            cambiarPantalla('screen-resumen', 'screen-fotos');
        }

        async function enviarInspeccion() {
            if (signaturePad.isEmpty()) {
                document.getElementById('alert-error').style.display = 'block';
                document.getElementById('error-mensaje').textContent = 'Debes firmar antes de enviar';
                return;
            }

            document.getElementById('btn-enviar').disabled = true;
            document.getElementById('alert-error').style.display = 'none';
            document.getElementById('screen-loading').classList.add('active');

            // Generar PDF
            await generarPDF();

            // Preparar datos para Google Sheets
            const datos = {
                vehiculo: appState.vehiculo,
                tipo: appState.tipo,
                conductor: appState.conductor,
                kilometraje: appState.kilometraje,
                ordenTrabajo: appState.ordenTrabajo,
                fecha: new Date().toISOString(),
                checklist: appState.checklist,
                observaciones: appState.observaciones,
                nivelGasolina: document.getElementById('nivel-gasolina').value,
                observacionesGenerales: document.getElementById('observaciones').value,
                fotos: appState.fotos.map(f => f.data),
                firma: appState.firmaData
            };

            const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzSgEhIn6AA6O__3WO7_k4KFu0verkyVLtV13f_MmzkxaEBYmCHwtUgZTPm9qNTTsj2DQ/exec';

            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(datos)
                });

                await new Promise(resolve => setTimeout(resolve, 2000));

                const idInspeccion = guardarInspeccionLocal();

                document.getElementById('screen-loading').classList.remove('active');
                cambiarPantalla('screen-resumen', 'screen-exito');
                document.getElementById('id-inspeccion').textContent = idInspeccion;
                
            } catch (error) {
                console.error('Error al enviar:', error);
                document.getElementById('screen-loading').classList.remove('active');
                document.getElementById('alert-error').style.display = 'block';
                document.getElementById('error-mensaje').textContent = 'Error al enviar. Intenta de nuevo.';
                document.getElementById('btn-enviar').disabled = false;
            }
        }

        async function generarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let yPos = 20;

            // Header
            doc.setFontSize(18);
            doc.setTextColor(45, 95, 79);
            doc.text('INSPECCI√ìN VEHICULAR', 105, yPos, { align: 'center' });
            
            yPos += 10;
            doc.setFontSize(12);
            doc.text('Ejecutiva Ambiental', 105, yPos, { align: 'center' });
            
            yPos += 15;
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);

            // Informaci√≥n general
            doc.text(`Veh√≠culo: ${document.querySelector('#vehiculo option:checked').textContent}`, 20, yPos);
            yPos += 7;
            doc.text(`Tipo: ${appState.tipo}`, 20, yPos);
            yPos += 7;
            doc.text(`Conductor: ${document.querySelector('#conductor option:checked').textContent}`, 20, yPos);
            yPos += 7;
            doc.text(`Kilometraje: ${appState.kilometraje} km`, 20, yPos);
            yPos += 7;
            doc.text(`Fecha: ${new Date().toLocaleString('es-MX')}`, 20, yPos);
            yPos += 10;

            // Checklist
            doc.setFontSize(12);
            doc.setTextColor(45, 95, 79);
            doc.text('Resultados del Checklist:', 20, yPos);
            yPos += 8;

            doc.setFontSize(9);
            doc.setTextColor(0, 0, 0);

            const itemLabels = {
                'luz_alta': 'Luz delantera alta',
                'luz_baja': 'Luz delantera baja',
                'luces_intermitentes': 'Luces intermitentes',
                'luz_direccional': 'Luz direccional',
                'luz_freno': 'Luz freno posterior',
                'tablero': 'Tablero/Indicadores',
                'luz_reversa': 'Luces de reversa',
                'alarma_reversa': 'Alarma de reversa',
                'espejo_izq': 'Espejo retrovisor izquierdo',
                'espejo_der': 'Espejo retrovisor derecho',
                'parabrisas_del': 'Parabrisas delantero',
                'parabrisas_tras': 'Parabrisas trasero',
                'llantas': 'Llantas',
                'carroceria': 'Carrocer√≠a',
                'limpieza_ext': 'Limpieza exterior',
                'cinturones': 'Cinturones de seguridad',
                'asientos': 'Asientos',
                'claxon': 'Claxon',
                'limpieza_int': 'Limpieza interior',
                'aire_ac': 'Aire acondicionado',
                'seguro': 'P√≥liza de seguro',
                'circulacion': 'Tarjeta de circulaci√≥n',
                'verificacion': 'Verificaci√≥n vehicular',
                'gato': 'Gato hidr√°ulico',
                'llanta_ref': 'Llanta de refacci√≥n',
                'se√±ales': 'Se√±ales de emergencia',
                'botiquin': 'Botiqu√≠n',
                'extintor': 'Extintor',
                'liq_frenos': 'L√≠quido de frenos',
                'anticongelante': 'Anticongelante',
                'liq_direccion': 'Direcci√≥n hidr√°ulica',
                'aceite_motor': 'Aceite de motor',
                'liq_limpia': 'Limpia parabrisas'
            };

            for (const [item, status] of Object.entries(appState.checklist)) {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }

                const statusIcon = status === 'good' ? '‚úì' : status === 'bad' ? '‚úó' : '‚óã';
                const statusColor = status === 'good' ? [39, 174, 96] : status === 'bad' ? [231, 76, 60] : [149, 165, 166];
                
                doc.setTextColor(...statusColor);
                doc.text(statusIcon, 20, yPos);
                doc.setTextColor(0, 0, 0);
                doc.text(itemLabels[item] || item, 30, yPos);

                if (appState.observaciones[item]) {
                    yPos += 5;
                    doc.setFontSize(8);
                    doc.setTextColor(133, 100, 4);
                    const lines = doc.splitTextToSize(`  ‚Üí ${appState.observaciones[item]}`, 170);
                    doc.text(lines, 30, yPos);
                    yPos += (lines.length * 4);
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                }

                yPos += 6;
            }

            // Observaciones generales
            const obsGenerales = document.getElementById('observaciones').value;
            if (obsGenerales) {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                yPos += 5;
                doc.setFontSize(10);
                doc.setTextColor(45, 95, 79);
                doc.text('Observaciones Generales:', 20, yPos);
                yPos += 6;
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                const obsLines = doc.splitTextToSize(obsGenerales, 170);
                doc.text(obsLines, 20, yPos);
                yPos += (obsLines.length * 5);
            }

            // Firma
            if (appState.firmaData) {
                if (yPos > 230) {
                    doc.addPage();
                    yPos = 20;
                }
                yPos += 10;
                doc.setFontSize(10);
                doc.setTextColor(45, 95, 79);
                doc.text('Firma del Conductor:', 20, yPos);
                yPos += 5;
                doc.addImage(appState.firmaData, 'PNG', 20, yPos, 60, 20);
            }

            // Guardar PDF como blob
            appState.pdfBlob = doc.output('blob');
        }

        function abrirPDF() {
            if (appState.pdfBlob) {
                const pdfUrl = URL.createObjectURL(appState.pdfBlob);
                window.open(pdfUrl, '_blank');
            }
        }

        function nuevaInspeccion() {
            location.reload();
        }

        function cambiarPantalla(actual, nueva) {
            document.getElementById(actual).classList.remove('active');
            document.getElementById(nueva).classList.add('active');
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
